# HomeSec Samba Configuration
# /etc/samba/smb.conf
#
# Provides SMB/CIFS file sharing for Windows, macOS, and Linux clients

#======================= Global Settings =======================

[global]
    # Server identification
    workgroup = HOMESEC
    server string = HomeSec NAS Server
    netbios name = HOMESEC-NAS

    # Security settings
    security = user
    map to guest = never
    passdb backend = tdbsam
    encrypt passwords = yes

    # Only allow connections from internal networks
    hosts allow = 192.168.10. 192.168.20. 192.168.30. 192.168.40. 127.
    hosts deny = 0.0.0.0/0

    # Logging
    log file = /var/log/samba/log.%m
    max log size = 1000
    log level = 1

    # Performance tuning
    socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=131072 SO_SNDBUF=131072
    read raw = yes
    write raw = yes
    max xmit = 65535
    dead time = 15
    getwd cache = yes

    # Disable printer sharing
    load printers = no
    printing = bsd
    printcap name = /dev/null
    disable spoolss = yes

    # Protocol settings
    server min protocol = SMB2
    server max protocol = SMB3
    client min protocol = SMB2
    client max protocol = SMB3

    # Disable unnecessary services
    wins support = no
    dns proxy = no

    # File permissions
    create mask = 0664
    directory mask = 0775
    force create mode = 0664
    force directory mode = 0775

    # Audit logging (optional - comment out if not needed)
    # vfs objects = full_audit
    # full_audit:prefix = %u|%I|%m|%S
    # full_audit:success = mkdir rmdir open read write rename unlink
    # full_audit:failure = none
    # full_audit:facility = local5
    # full_audit:priority = notice

#======================= Share Definitions =======================

# Shared Files - Accessible to VLAN 10 and 20
[shared]
    comment = General Shared Files
    path = /mnt/storage/shared
    valid users = @users
    read only = no
    browseable = yes
    writable = yes
    create mask = 0664
    directory mask = 0775
    hosts allow = 192.168.10. 192.168.20.

# Backups - Infrastructure VLAN only (VLAN 20)
[backups]
    comment = System Backups
    path = /mnt/storage/backups
    valid users = root admin
    read only = no
    browseable = yes
    writable = yes
    create mask = 0600
    directory mask = 0700
    hosts allow = 192.168.20.

# Logs Archive - Infrastructure VLAN only (VLAN 20)
[logs]
    comment = Archived Logs
    path = /mnt/storage/logs
    valid users = root admin
    read only = no
    browseable = yes
    writable = yes
    hosts allow = 192.168.20.

# Documents - Trusted and Infrastructure VLANs
[documents]
    comment = Documents
    path = /mnt/storage/documents
    valid users = @users
    read only = no
    browseable = yes
    writable = yes
    hosts allow = 192.168.10. 192.168.20.

# Media - Accessible to trusted devices and guest/IoT (read-only for guest)
[media]
    comment = Media Files
    path = /mnt/storage/media
    valid users = @users
    read only = no
    browseable = yes
    writable = yes
    hosts allow = 192.168.10. 192.168.20. 192.168.30.

    # Guest/IoT VLAN gets read-only access
    write list = @users
    read list = +guests

# User home directories (optional)
# [homes]
#     comment = Home Directories
#     browseable = no
#     writable = yes
#     create mask = 0700
#     directory mask = 0700
#     valid users = %S

#======================= Admin Shares (Hidden) =======================

# Configuration backup share (hidden from browsing)
[config]
    comment = Configuration Backups
    path = /mnt/storage/backups/config
    valid users = root admin
    read only = no
    browseable = no
    writable = yes
    hosts allow = 192.168.20.

# Elasticsearch snapshots (hidden)
[elasticsearch]
    comment = Elasticsearch Snapshots
    path = /mnt/storage/backups/elasticsearch
    valid users = elasticsearch
    read only = no
    browseable = no
    writable = yes
    hosts allow = 192.168.20.10

#======================= Recycle Bin (Optional) =======================

# Enable recycle bin for accidental deletions
# Uncomment to enable for each share:
#
# [shared]
#     vfs objects = recycle
#     recycle:repository = .recycle
#     recycle:keeptree = yes
#     recycle:versions = yes
#     recycle:touch = yes
#     recycle:maxsize = 0
